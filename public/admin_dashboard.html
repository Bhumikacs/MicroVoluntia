<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard | MicroVoluntia</title>
  <link rel="stylesheet" href="style_main.css" />
  <link rel="stylesheet" href="style_dashboard.css" />
</head>
<body>
  <!-- Header -->
  <header>
    <nav class="navbar">
      <div class="logo">MicroVoluntia Admin</div>
      <ul class="nav-links">
        <li><a href="admin.html">Home</a></li>
        <li><a href="admin_user.html">Users</a></li>
        <li><a href="admin_dashboard.html" class="active">Dashboard</a></li>
        <li><a href="event_form.html">Events</a></li>
        <li><a href="all_events.html">All Events</a></li>
        <li><a href="login.html" id="logoutBtn">Logout</a></li>
      </ul>
    </nav>
  </header>

  <!-- Dashboard Container -->
  <div class="container mt-5">
    <h2 class="mb-4 text-center">Admin Dashboard</h2>

    <!-- Upcoming Events -->
    <div class="col-md-6">
      <div class="card bg-light">
        <div class="card-body">
          <h5 class="card-title">Upcoming Events</h5>
          <ul>
            <li>Clean City Drive – Sep 20</li>
            <li>Food Distribution – Sep 25</li>
            <li>Education Support Camp – Oct 1</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Recent Pre-Registrations -->
    <div class="col-md-12 mb-4">
      <div class="card bg-light">
        <div class="card-body">
          <h5 class="card-title">Recent Pre-Registrations</h5>
          <table class="table table-striped" id="preRegTable">
            <thead>
              <tr>
                <th>Full Name</th>
                <th>DOB</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Event</th>
                <th>Registered At</th>
              </tr>
            </thead>
            <tbody>
              <!-- Rows will be populated here -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <script>
    // =====================
    // Logout Function
    // =====================
    document.getElementById("logoutBtn").addEventListener("click", function(e) {
      e.preventDefault();
      // Clear any stored login/session data
      localStorage.clear();
      sessionStorage.clear();
      alert("You have been logged out!");
      // Redirect to login page
      window.location.href = "login.html";
    });

    // =====================
    // Load Pre-Registrations
    // =====================
    async function loadPreRegistrations() {
      try {
        const res = await fetch("https://microvoluntia-lfxx.onrender.com/admin/pre_registrations");
        if (!res.ok) throw new Error("Failed to fetch pre-registrations");
        const data = await res.json();

        const tableBody = document.querySelector("#preRegTable tbody");
        tableBody.innerHTML = ""; // clear previous rows

        data.forEach(reg => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${reg.fullname}</td>
            <td>${new Date(reg.dob).toLocaleDateString()}</td>
            <td>${reg.email}</td>
            <td>${reg.phone}</td>
            <td>${reg.event}</td>
            <td>${new Date(reg.createdAt).toLocaleString()}</td>
          `;
          tableBody.appendChild(row);
        });
      } catch (err) {
        console.error("Failed to load pre-registrations:", err);
      }
    }

    // Load pre-registrations when page loads
    window.addEventListener("DOMContentLoaded", loadPreRegistrations);
  </script>
</body>
</html>
